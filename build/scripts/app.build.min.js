!function(t,i,e){e.define("BaseClass",[],function(t){function e(){this.initialize.apply(this,arguments)}i.mixin(e.prototype,{initialize:function(){},destroy:function(){}}),t(e)})}(this,this._,this.modules),function(t,i){i.define("Canvas",["tools","PubSub"],function(t,i,e){var n=i.extend(e),s=n,a=s.superclass;_.mixin(s.prototype,{initialize:function(){a.initialize.apply(this,arguments),this._canvas=null,this._context=null,this._width=null,this._height=null,this._initElement()},size:function(t){return _.isPlainObject(t)?(_.isNumber(t.height)&&(this._height=t.height),_.isNumber(t.width)&&(this._width=t.width),this._canvas.width=this._width,this._canvas.height=this._height,this.redraw(),void 0):{width:this._width,height:this._height}},redraw:function(){this._canvas.width=this._canvas.width},getCanvas:function(){return this._canvas},getContext:function(){return this._context},_initElement:function(){_.isNull(this._canvas)&&(this._canvas=document.createElement("canvas"),this._context=this._canvas.getContext("2d"))}}),t(n)})}(this,modules),function(t,i){i.define("Debouncer",["tools","PubSub"],function(t,i,e){var n=i.extend(e),s=n,a=s.superclass;_.extend(s.prototype,{initialize:function(t){a.initialize.apply(this,arguments),this._callback=null,this._timeout=null,this._enabled=!1,this._timeoutHandler=null,t&&(t.callback&&(this._callback=t.callback),t.timeout&&(this._timeout=t.timeout))},start:function(){this._enabled=!0,this._tick()},stop:function(){clearTimeout(this._timeoutHandler),this._enabled=!1},_tick:function(){this._enabled&&(clearTimeout(this._timeoutHandler),this._timeoutHandler=setTimeout(function(){this._callback(),this._tick()}.bind(this),this._timeout))}}),t(n)})}(this,this.modules),function(t,i){i.define("Drawable",["tools","consts","Canvas","Dispatcher"],function(t,i,e,n,s){var a=i.extend(n),o=a,h=o.superclass;_.extend(o.prototype,{initialize:function(){h.initialize.apply(this,arguments),this._childDrawables=[],this._idle=!1,this._defineProperties(),this._listenToDispatcher(),this._updateSize()},_defineProperties:function(){var t=0,i=0;Object.defineProperty(this,"x",{get:function(){return t},set:function(i){_.isNumber(i)&&(t=i)}}),Object.defineProperty(this,"y",{get:function(){return i},set:function(t){_.isNumber(t)&&(i=t)}}),Object.defineProperty(this,"width",{get:function(){return this.size().width}.bind(this)}),Object.defineProperty(this,"height",{get:function(){return this.size().height}.bind(this)})},idle:function(t){this._idle=!!t},draw:function(){this._idle?this.redraw():(this._draw(),this._drawChildren())},_draw:function(){},addChild:function(t){t&&t instanceof a&&this._childDrawables.push(t)},_drawChildren:function(){this._childDrawables.forEach(function(t){this._drawChild(t)}.bind(this))},_drawChild:function(t){},_listenToDispatcher:function(){s.on("window-resize",function(){this._onWindowResize()}.bind(this))},_onWindowResize:function(){this._updateSize()},_updateSize:function(){this.size({width:e.GAME_WIDTH,height:e.GAME_HEIGHT})}}),t(a)})}(this,this.modules),function(t,i){i.define("PubSub",["tools","BaseClass"],function(t,i,e){var n=i.extend(e),s=n,a=s.superclass;_.mixin(s.prototype,{initialize:function(){this._events=[],a.initialize.apply(this,arguments)},_notify:function(t){if(this._eventExists(t)){var i=this,e=Array.prototype.slice.call(arguments,1),n=this._getEventObject(t),s=!1;n.forEach(function(t){e.length>0?t.callback.apply(t.context,e):t.callback.call(t.context),_.isNumber(t.times)&&(t.times-=1,t.times<=0&&(i.off(t.event,t.callback,t.context),s=!0))})}},on:function(t,i,e){_.isUndefined(t)&&_.isUndefined(i)||(_.isArray(t)?t.forEach(function(t){this._pushEvent(t,i,e)}.bind(this)):_.isString(t)&&(-1!==t.indexOf(" ")?(t=t.split(" "),t.forEach(function(t){this._pushEvent(t,i,e)}.bind(this))):this._pushEvent(t,i,e)))},_pushEvent:function(t,i,e){this._events.push({event:t,callback:i,context:e})},once:function(t,i,e){void 0!==t&&void 0!==i&&this._events.push({event:t,callback:i,context:e,times:1})},off:function(t,i,e){if(0===arguments.length)return this._events.length=0,void(this._events=[]);if(_.isArray(t))return void t.forEach(function(t){this.off(t,i,e)}.bind(this));if(_.isString(t)&&-1!==t.indexOf(" "))return this.off(t.split(" "),i,e);if(this._eventExists(t)){var n,s,a=this._events.length;for(n=0;a>n;++n)if(s=this._events[n],_.isUndefined(i)||_.isUndefined(e)){if(!_.isUndefined(i)&&_.isUndefined(e)){if(s.event===t&&s.callback===i)return void this._events.splice(n,1)}else if(!_.isUndefined(t)&&s.event===t)return void this._events.splice(n,1)}else if(s.event===t&&s.callback===i&&s.context===e)return void this._events.splice(n,1)}},destroy:function(){_.isArray(this._events)&&(this._events.length=0,this._events=null),a.destroy.apply(this,arguments)},_getEventObject:function(t){var i,e=this._events.length,n=[];for(i=0;e>i;++i)this._events[i].event===t&&n.push(this._events[i]);return n},_eventExists:function(t){if(!this._events)return!1;var i,e=this._events.length;for(i=0;e>i;++i)if(this._events[i].event===t)return!0;return!1}}),t(n)})}(this,this.modules),function(t,i){i.define("Resource",["tools","consts","Drawable"],function(t,i,e,n){var s=i.extend(n),a=s,o=a.superclass;_.mixin(a.prototype,{initialize:function(t){o.initialize.apply(this,arguments),this._src=null,this._resource=null,this._width=null,this._height=null,this.setConfig(t),this.load()},setConfig:function(t){t&&(t.width&&(this._width=t.width),t.height&&(this._height=t.height),t.src&&(this._src=t.src))},load:function(){this._resource=null;var t=new Image;t.onload=function(){this._resource=t,this._updateSize()}.bind(this),t.src=this._src},draw:function(){_.isNull(this._resource)||o.draw.apply(this,arguments)},_draw:function(){this.redraw(),this._context.drawImage(this._resource,0,0,this._resource.width,this._resource.height)},_drawObjects:function(){},_clear:function(){},_updateSize:function(){this._width&&this._height?this.size({width:this._width,height:this._height}):this._resource&&this.size({width:this._resource.width,height:this._resource.height})}}),t(s)})}(this,this.modules),function(t,i){i.define("Sprite",["tools","consts","Drawable","Drawer"],function(i,e,n,s,a){var o=e.extend(s),h=o,r=h.superclass;_.extend(h.prototype,{initialize:function(t){r.initialize.apply(this,arguments),this._sprite=null,this._resource=null,this._currentStep=0,this._steps=0,this._speed=100,this._direction=n.SPRITE_DIRECTION_VER,this._loop=!0,this._animating=!0,this._timeAfterPrevFrame=0,this._isStopped=!1,t&&(t.size&&this.size(t.size),t.steps&&(this._steps=t.steps),t.speed&&(this._speed=t.speed),t.direction&&(this._direction=t.direction),void 0!==t.loop&&(this._loop=t.loop),t.sprite&&(this._sprite=t.sprite)),this._loadResource(),this._bindEvents()},start:function(){this._animating=!0},stop:function(){this._animating=!1},_loadResource:function(){var t=new Image;t.onload=function(){this._resource=t}.bind(this),t.src=this._sprite},_bindEvents:function(){a.on("animation-frame",function(t){this._calculateNextFrame(t)}.bind(this))},_calculateNextFrame:function(t){if(this._sprite){if(!this._animating)return void(this._timeAfterPrevFrame=0);if(this._timeAfterPrevFrame+=1e3*t,!(this._timeAfterPrevFrame<this._speed)){var i=Math.floor(this._timeAfterPrevFrame/this._speed);this._timeAfterPrevFrame=this._timeAfterPrevFrame%this._speed;var e=this._currentStep+i;if(e>this._steps){if(this._loop===!1)return this._isStopped=!0,void this._notify("animation-end");this._currentStep=e%this._steps}else this._currentStep=e}}},_draw:function(){if(this.redraw(),this._sprite&&this._resource&&!this._isStopped){var i=this.size();void 0===t.a&&(t.a=0),this._direction===n.SPRITE_DIRECTION_VER?this._context.drawImage(this._resource,0,0,i.width,i.height*this._steps,0,(this._currentStep-1)*-i.height,i.width,i.height*this._steps):this._context.drawImage(this._resource,0,0,i.width,i.height,this._currentStep*i.width,0,i.width,i.height)}},_updateSize:function(){this.size(this.size())}}),i(o)})}(this,this.modules),function(t,i){i.define("tools",[],function(t){function i(t){var i=function(){},e=function(){return this.initialize.apply(this,arguments)};return i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e,e.superclass=i.prototype,e}t({extend:i})})}(this,modules),function(t,i){i.define("View",["tools","PubSub"],function(i,e,n){var s=e.extend(n),a=s,o=a.superclass;_.mixin(a.prototype,{initialize:function(i){o.initialize.apply(this,arguments);var e;Object.defineProperty(this,"el",{get:function(){return e&&e.length>0?e:null},set:function(i){i&&t.$&&(e=i instanceof t.$?i:t.$(i))}}),i&&i.el&&(this.el=i.el)}}),i(s)})}(this,this.modules),function(t,i){i.define("AppCanvas",["tools","consts","Drawable","LightPair","Countdown","Traffic"],function(i,e,n,s,a,o,h){var r=e.extend(s),c=r,u=c.superclass;_.mixin(c.prototype,{initialize:function(){u.initialize.apply(this,arguments),this._init()},_draw:function(){this._context.beginPath(),this._context.fillStyle="#000000",this._context.rect(0,0,this._canvas.width,this._canvas.height),this._context.fill()},_drawChild:function(t){t instanceof a?this._drawLightPair(t):t instanceof o?this._drawCountdown(t):t instanceof h&&this._drawTraffic(t)},_drawLightPair:function(t){t.draw(),this._context.drawImage(t.getCanvas(),0,0)},_drawCountdown:function(t){t.draw(),this._context.drawImage(t.getCanvas(),0,0)},_drawTraffic:function(t){var i=t.size();t.draw(),t.isVer()?this._context.drawImage(t.getCanvas(),this._canvas.width/2-i.width/2,0):t.isHor()&&this._context.drawImage(t.getCanvas(),0,this._canvas.height/2-i.height/2)},_init:function(){this._canvas.setAttribute("id","app-canvas"),document.body.appendChild(this._canvas),this._updateSize()},_updateSize:function(){this.size({width:t.innerWidth,height:t.innerHeight})}}),i(r)})}(this,modules),function(t,i){i.define("consts",function(t){t({GAME_WIDTH:1700,GAME_HEIGHT:1300,PLAYER_WIDTH:60,PLAYER_HEIGHT:216,BULLETS_PER_SECOND:1,BOTTLE_COLOR_GREEN:"green",BOTTLE_COLOR_ORANGE:"orange",BOTTLE_COLOR_RED:"red",SPRITE_DIRECTION_HOR:"hor",SPRITE_DIRECTION_VER:"ver",CAKE_WIDTH:50,CAKE_HEIGHT:50,ENEMY_TYPE_1:"1",ENEMY_TYPE_2:"2",ENEMY_TYPE_3:"3",ENEMY_TYPE_4:"4",ENEMY_TYPE_5:"5",ENEMY_CELL_WIDTH:140,ENEMY_CELL_HEIGHT:120,ENEMIES_ROWS_COUNT:4,ENEMIES_COLS_COUNT:10,EXPLOSION_WIDTH:96,EXPLOSION_HEIGHT:96})})}(this,modules),function(t,i){i.define("ControlsClass",["tools","PubSub"],function(i,e,n){var s=e.extend(n),a=s,o=a.superclass,h=$(t);_.mixin(a.prototype,{initialize:function(){o.initialize.apply(this,arguments),this._leftPressed=!1,this._rightPressed=!1,this._bindEvents()},isLeftPressed:function(){return this._leftPressed},isRightPressed:function(){return this._rightPressed},_bindEvents:function(){h.on("keydown",function(t){this._onKeyDown(t)}.bind(this)),h.on("keyup",function(t){this._onKeyUp(t)}.bind(this))},_onKeyDown:function(t){this._isKeyCodeLeft(t.keyCode)&&(this._leftPressed=!0),this._isKeyCodeRight(t.keyCode)&&(this._rightPressed=!0),this._isKeyCodeWhitespace(t.keyCode)&&this._notify("whitespace-pressed")},_onKeyUp:function(t){this._isKeyCodeLeft(t.keyCode)&&(this._leftPressed=!1),this._isKeyCodeRight(t.keyCode)&&(this._rightPressed=!1)},_isKeyCodeLeft:function(t){return 37===t},_isKeyCodeRight:function(t){return 39===t},_isKeyCodeWhitespace:function(t){return 32===t}}),i(s)});var e=null;i.define("Controls",["ControlsClass"],function(t,i){_.isNull(e)&&(e=new i),t(e)})}(this,this.modules),function(t,i){var e;i.define("Dispatcher",["tools","PubSub"],function(t,i,n){e||(e=new(i.extend(n))),t(e)})}(this,this.modules),function(t,i){var e=null;i.define("DrawerConstructor",["tools","PubSub"],function(i,n,s){if(e)return void i(e);var a=n.extend(s),o=a,h=o.superclass;_.extend(o.prototype,{initialize:function(){h.initialize.apply(this,arguments),this._enabled=!1,this._delta=null,this._timePrev=null,this._timeNow=null},start:function(){this._enabled||(this._enabled=!0,this._tick())},stop:function(){this._enabled=!1},getDelta:function(){return this._delta},_tick:function(){return null===this._timePrev?(this._timePrev=(new Date).getTime(),this._tick()):void(this._enabled&&t.requestAnimationFrame(function(){this._timeNow=(new Date).getTime(),this._delta=(this._timeNow-this._timePrev)/1e3,this._timePrev=this._timeNow,this._notify("animation-frame",this._delta),t.requestAnimationFrame(function(){this._tick()}.bind(this))}.bind(this)))}}),i(a)});var e;i.define("Drawer",["DrawerConstructor"],function(t,i){e||(e=new i),t(e)})}(this,this.modules),function(t,i){i.define("windowResize",["Dispatcher"],function(i,e){var n;t.addEventListener("resize",function(){clearTimeout(n),n=setTimeout(function(){e._notify("window-resize")},300)});t.addEventListener("keydown",function(t){37===t.keyCode}),i()})}(this,modules),function(t,i){document.addEventListener("DOMContentLoaded",function(){i.require(["appInit"],function(t){t()})})}(this,this.modules),function(t,i){i.define("appInit",["Dispatcher","windowResize","Scene","Drawer"],function(t,i,e,n,s){t(function(){var t=new n;t.start()})})}(this,this.modules),function(t,i){i.define("Scene",["tools","consts","PubSub","ScreenIntro","ScreenGame"],function(i,e,n,s,a,o){var h=e.extend(s),r=h,c=r.superclass;_.extend(r.prototype,{initialize:function(){c.initialize.apply(this,arguments),this._screenIntro=null,this._screenGame=null,this._initScreens(),t.scene=this},_initScreens:function(){_.isNull(this._screenIntro)&&(this._screenIntro=new a),_.isNull(this._screenGame)&&(this._screenGame=new o)},start:function(){this._screenIntro&&(this._screenIntro.on("end",function(){this._screenIntro.fadeOut(function(){this._screenGame.fadeIn(),this._screenGame.start()}.bind(this))}.bind(this)),this._screenIntro.fadeIn(function(){this._screenIntro.start()}.bind(this)))}}),i(h)})}(this,this.modules),function(t,i){i.define("StateLoop",["tools","consts","PubSub"],function(t,i,e,n){var s=i.extend(n),a=s,o=a.superclass;_.extend(s.prototype,{initialize:function(){o.initialize.apply(this,arguments),this._timeoutHandler=null,this._minTimeUnit=100,this._timePassedAfterLastState=0,this._currentState=null,this._states=[],this._enabled=!1},registerState:function(t){return Array.isArray(t)?t.forEach(function(t){this.registerState(t)}.bind(this)):void this._states.push(t)},start:function(){this._enabled||(this._enabled=!0,this._currentState||(this._currentState=this._states[0],this._currentState.callback()),this._tick())},stop:function(){clearTimeout(this._timeoutHandler),this._enabled=!1},clearStates:function(){this.stop(),this._states.length=0,this._states=[]},_tick:function(){return this._enabled?(this._timeoutHandler=setTimeout(function(){this._timePassedAfterLastState+=this._minTimeUnit,this._checkIfHasToMakeStateTransition()}.bind(this),this._minTimeUnit),void this._notify("tick",{timeLeftBeforeNextState:this._currentState.duration-this._timePassedAfterLastState})):clearTimeout(this._timeoutHandler)},_checkIfHasToMakeStateTransition:function(){this._timePassedAfterLastState>=this._currentState.duration&&(this._timePassedAfterLastState=0,this._currentState=this._getNextState(),this._currentState.callback()),this._tick()},_getNextState:function(){return this._states.filter(function(t){return t.state===this._currentState.to}.bind(this))[0]}}),t(s)})}(this,this.modules),function(t,i){i.define("Screen",["tools","View"],function(i,e,n){var s=e.extend(n),a=s,o=a.superclass;_.mixin(a.prototype,{initialize:function(t){o.initialize.apply(this,arguments),this._currentState=null,this._states=[],this.el=null,this._initElement(),this._registerStates()},start:function(){this.nextState()},nextState:function(){var t,i,e=this._currentState;null===this._currentState?this._currentState=0:this._currentState=Math.max(0,Math.min(this._states.length-1,this._currentState+1)),this._currentState!==e&&(t=this._states[this._currentState],t.name&&(this.el.attr("data-state",t.name),this.el.addClass("m-"+t.name)),t.before&&t.before(),t.after&&t.duration&&(i=setTimeout(function(){t.after(),clearTimeout(i)},t.duration)))},_registerStates:function(){},_registerState:function(t){return _.isArray(t)?void t.forEach(function(t){this._registerState(t)}.bind(this)):void this._states.push(t)},_initElement:function(){this.el=t.$('.scene[data-name="'+this._getPartName()+'"]')},_getPartName:function(){return""},_notifyEnd:function(){this._notify("end")},fadeIn:function(t){this.el.removeClass("m-hidden"),setTimeout(function(){t&&t()}.bind(this),500)},fadeOut:function(t){this.el.addClass("m-hidden"),setTimeout(function(){t&&t()}.bind(this),500)}}),i(s)})}(this,this.modules),function(t,i){i.define("ScreenGame",["tools","Screen","Game"],function(t,i,e,n){var s=i.extend(e),a=s,o=a.superclass;_.mixin(a.prototype,{initialize:function(t){o.initialize.apply(this,arguments),this._game=null,this._initGame(),this._bindEvents()},_initGame:function(){_.isNull(this._game)&&(this._game=new n({el:this.el.find(".game")}))},_bindEvents:function(){},_getPartName:function(){return"game"},_registerStates:function(){this._registerState([{name:"title-appears",after:function(){this.nextState()}.bind(this),duration:2e3},{name:"title-disappears",after:function(){}.bind(this),duration:2e3}])}}),t(s)})}(this,this.modules),function(t,i){i.define("ScreenIntro",["tools","Screen"],function(t,i,e){var n=i.extend(e),s=n,a=s.superclass;_.mixin(s.prototype,{initialize:function(t){a.initialize.apply(this,arguments),this.$karina=this.el.find(".karina"),this.$karinaDialogBox=this.$karina.find(".karina-dialog"),this.$karinaDialogText=this.$karina.find(".karina-dialog-text"),this.$yes=this.el.find(".control"),this._typedInited=!1,this._bindEvents()},_bindEvents:function(){this.$yes.on("click",function(){this.nextState(),this.$yes.off("click")}.bind(this))},_registerStates:function(){this._registerState([{name:"karina-appears",after:function(){this.nextState()}.bind(this),duration:1e3},{name:"karina-speaks",before:function(){this._speakIntro()}.bind(this),after:function(){this.nextState()}.bind(this),duration:4700},{name:"controls-shown"},{name:"yes-pressed",before:function(){this._speakNiceChoice()}.bind(this),after:function(){this.nextState()}.bind(this),duration:4e3},{name:"karina-disappears",after:function(){this.nextState()}.bind(this),duration:2e3},{name:"end",before:function(){this._notifyEnd()}.bind(this)}])},_recreateTextContainer:function(){var t=this.$karinaDialogText.attr("class");this.$karinaDialogText.remove(),this.$karinaDialogText=$("<div>"),this.$karinaDialogText.addClass(t),this.$karinaDialogText.appendTo(this.$karinaDialogBox)},_speakNiceChoice:function(){return this._speak("As I thought^300, time-waster. ^800Good luck!")},_speakIntro:function(){return this._speak("hey m^25a^25a^25a^25a^25a^25a^25a^25a^25a^25a^25a^25a^25a^25an, ^300have you ever striked down cocktails by cidor caps? ^500Wanna try?")},_speak:function(t){this._recreateTextContainer(),this.$karinaDialogText.typed({strings:[t],loop:!1,showCursor:!1})},_getPartName:function(){return"intro"}}),t(n)})}(this,this.modules),function(t,i){i.define("Bullets",["tools","consts","Drawable","Drawer","Cake"],function(t,i,e,n,s,a){var o=i.extend(n),h=o,r=h.superclass;_.mixin(h.prototype,{initialize:function(t){r.initialize.apply(this,arguments),this._speed=750,this._cakes=[]},emit:function(t){var i=t&&t.speed?t.speed:this._speed,n=t&&t.x?t.x:0,s=t&&t.y?t.y:0,o=new a;this._cakes.push({o:o,s:i,x:n,y:s,w:e.CAKE_WIDTH,h:e.CAKE_HEIGHT})},getObjects:function(){return this._cakes},destroyObject:function(t){this._cakes.splice(t,1)},_draw:function(){this.redraw(),this._cakes.forEach(function(t){var i=t.o.size();t.o.draw(),this._context.drawImage(t.o.getCanvas(),t.x-i.width/2,t.y-i.height/2,i.width,i.height),t.y=t.y+s.getDelta()*t.s*-1}.bind(this)),this._clear()},_clear:function(){var t,i=this._cakes.length-1;for(i;i>-1;--i)t=this._cakes[i],t.y+t.o.height<0&&(t=null,this.destroyObject(i))}}),t(o)})}(this,this.modules),function(t,i){i.define("GameCanvas",["tools","consts","Drawable","Player","Bullets","Enemies"],function(t,i,e,n,s,a,o){var h=i.extend(n),r=h,c=r.superclass;_.mixin(r.prototype,{initialize:function(t){c.initialize.apply(this,arguments)},draw:function(){c.draw.apply(this,arguments),this._notify("frame-drawn")},_draw:function(){this.redraw()},_drawChild:function(t){t instanceof s?this._drawPlayer(t):t instanceof a?this._drawBullets(t):t instanceof o&&this._drawEnemies(t)},_drawPlayer:function(t){t.draw(),this._context.drawImage(t.getCanvas(),t.x,t.y,t.width,t.height)},_drawBullets:function(t){t.draw(),this._context.drawImage(t.getCanvas(),0,0,this.width,this.height)},_drawEnemies:function(t){t.draw(),this._context.drawImage(t.getCanvas(),0,0,this.width,this.height)}}),t(h)})}(this,this.modules),function(t,i){i.define("Enemies",["tools","consts","Drawable","Drawer","Cake","AllEnemies","Explosion"],function(t,i,e,n,s,a,o,h){var r=i.extend(n),c=r,u=c.superclass;_.mixin(c.prototype,{initialize:function(t){u.initialize.apply(this,arguments),this._objects=[],this._movingSpeed=50,this._movingDelta=1,this._currentMoveOffset=0,this._totalWidth=e.ENEMY_CELL_WIDTH*e.ENEMIES_COLS_COUNT,this._totalHeight=e.ENEMY_CELL_HEIGHT*e.ENEMIES_ROWS_COUNT,this._offsetX=this._canvas.width/2-this._totalWidth/2-this._movingSpeed/2,this._offsetY=100,this._explosions=[],this.createObjects(),this._startDeltaChanging(),this._bindEvents()},createObjects:function(){var t,i,n,s,a=o,h=0,r=0;for(this._objects.length=0,this._objects=[],i=[],h;h<e.ENEMIES_ROWS_COUNT;++h){for(t=[],r=0;r<e.ENEMIES_COLS_COUNT;r++)n=r%a.length,s=new a[n].constr,t.push({o:s,x:r*e.ENEMY_CELL_WIDTH+this._offsetX,y:h*e.ENEMY_CELL_HEIGHT+this._offsetY,w:e.ENEMY_CELL_WIDTH,h:e.ENEMY_CELL_HEIGHT});i.push(t)}i.forEach(function(t){this._objects=this._objects.concat(t)}.bind(this)),i=null},getObjects:function(){return this._objects.filter(function(t){return!_.isNull(t)})},destroyObject:function(t){var i=this._objects[t];this._makeExplosion(i),this._objects.splice(t,1)},_bindEvents:function(){s.on("animation-frame",function(t){this._currentMoveOffset+=this._movingSpeed*t*this._movingDelta}.bind(this))},_startDeltaChanging:function(){var t=this;setTimeout(function i(){t._movingDelta*=-1,setTimeout(i,1e3)}.bind(this),1e3)},_makeExplosion:function(t){var i=(t.x+t.w/2,t.y+t.h/2,new h);i.on("animation-end",function(){var t;i.off(),t=this._explosions.map(function(t,e){return t.o===i?e:void 0}).filter(function(t){return void 0!==t})[0],void 0!==t&&this._explosions.splice(t,1)}.bind(this)),this._explosions.push({o:i,x:t.x+t.w/2-e.EXPLOSION_WIDTH/2,y:t.y+t.h/2-e.EXPLOSION_HEIGHT/2})},_draw:function(){this.redraw(),this._drawObjects(),this._drawExplosions(),this._clear()},_drawObjects:function(){this._objects.forEach(function(t){_.isNull(t)||this._drawObject(t)}.bind(this))},_drawExplosions:function(){this._explosions.forEach(function(t){var i=t.o,e=i.size();i.draw(),this._context.drawImage(i.getCanvas(),t.x,t.y,e.width,e.height)}.bind(this))},_drawObject:function(t){var i=t.o,e=t.x,n=t.y;i.draw(),this._context.drawImage(i.getCanvas(),e+this._currentMoveOffset,n,i.width,i.height)},_clear:function(){}}),t(r)})}(this,this.modules),function(t,i){i.define("Game",["tools","consts","View","Drawer","Controls","GameCanvas","Player","Cake","Bullets","Enemies"],function(t,i,e,n,s,a,o,h,r,c,u){var l=i.extend(n),d=l,f=d.superclass;_.mixin(d.prototype,{initialize:function(t){f.initialize.apply(this,arguments),this._canvas=null,this._player=null,this._bullets=null,this._enemies=null,this._playerCanFire=!0,this._initPlayer(),this._initBullets(),this._initEnemies(),this._initCanvas(),this._bindEvents(),s.start()},_bindEvents:function(){s.on("animation-frame",function(t){this._canvas.draw()}.bind(this)),a.on("whitespace-pressed",function(){this._fireFriendlyBullet()}.bind(this)),this._canvas.on("frame-drawn",function(){this._onFrameDrawn()}.bind(this))},_fireFriendlyBullet:function(){if(this._playerCanFire){this._playerCanFire=!1;var t=this._player.pos(),i=this._player.size();this._bullets.emit({x:t.x+i.width/2,y:t.y}),setTimeout(function(){this._playerCanFire=!0}.bind(this),1e3/e.BULLETS_PER_SECOND)}},_onFrameDrawn:function(){this._calculatePenetrations()},_calculatePenetrations:function(){this._calculateCakesWithEnemiesPenetrations()},_calculateCakesWithEnemiesPenetrations:function(){var t=this._bullets.getObjects(),i=this._enemies.getObjects({plain:!0});if(0!==t.length&&0!==i.length){var e,n;t.forEach(function(t,s){i.forEach(function(i,a){var o=i.o.getBoundingBox(),h={x:t.x,y:t.y,w:t.w,h:t.h},r={x:i.x+2*o.l,y:i.y-o.t,w:o.w,h:o.h};h.x<r.x+r.w&&h.x+h.w>r.x&&h.y<r.y+r.h&&h.h+h.y>r.y&&(e=s,n=a)})}),void 0!==e&&(console.log(t[e]),this._bullets.destroyObject(e)),void 0!==n&&(console.log(i[n].x,i[n].o.getBoundingBox()),this._enemies.destroyObject(n))}},_initPlayer:function(){_.isNull(this._player)&&(this._player=new h)},_initBullets:function(){_.isNull(this._bullets)&&(this._bullets=new c)},_initEnemies:function(){_.isNull(this._enemies)&&(this._enemies=new u)},_initCanvas:function(){_.isNull(this._canvas)&&(this._canvas=new o,this._canvas.addChild(this._player),this._canvas.addChild(this._bullets),this._canvas.addChild(this._enemies),this.el.append(this._canvas.getCanvas()))}}),t(l)})}(this,this.modules),function(t,i){i.define("Player",["tools","consts","Drawer","Controls","Drawable","Bottle"],function(t,i,e,n,s,a,o){var h=i.extend(a),r=h,c=r.superclass;_.mixin(r.prototype,{initialize:function(t){c.initialize.apply(this,arguments),this._bottle=null,this._speed=500,this.x=e.GAME_WIDTH/2-e.PLAYER_WIDTH/2,this.y=e.GAME_HEIGHT-e.PLAYER_HEIGHT+30,this._initObjects()},pos:function(){return{x:this.x,y:this.y}},_initObjects:function(){_.isNull(this._bottle)&&(this._bottle=new o({color:e.BOTTLE_COLOR_GREEN}))},_draw:function(){var t=null;s.isLeftPressed()&&(t=-1),s.isRightPressed()&&(t=1),_.isNull(t)||(this.x=this.x+t*this._speed*n.getDelta(),this.x=Math.max(0,Math.min(e.GAME_WIDTH-e.PLAYER_WIDTH,this.x))),this._bottle.draw(),this._context.drawImage(this._bottle.getCanvas(),0,0,e.PLAYER_WIDTH,e.PLAYER_HEIGHT)},_updateSize:function(){this.size({width:e.PLAYER_WIDTH,height:e.PLAYER_HEIGHT})}}),t(h)})}(this,this.modules),function(t,i){i.define("Bottle",["tools","consts","Drawable"],function(t,i,e,n){var s=i.extend(n),a=s,o=a.superclass;_.mixin(a.prototype,{initialize:function(t){o.initialize.apply(this,arguments),this._color=e.BOTTLE_COLOR_GREEN,this._image=null,t&&t.color&&(this._color=t.color),this._loadImage()},_loadImage:function(){if(_.isNull(this._image)){var t=new Image;t.onload=function(){this._image=t}.bind(this),this._color===e.BOTTLE_COLOR_GREEN?t.src="/resources/images/bottle/3.png":this._color===e.BOTTLE_COLOR_ORANGE?t.src="/resources/images/bottle/2.png":this._color===e.BOTTLE_COLOR_RED&&(t.src="/resources/images/bottle/1.png")}},_draw:function(){_.isNull(this._image)||this._context.drawImage(this._image,0,0,e.PLAYER_WIDTH,e.PLAYER_HEIGHT)},_updateSize:function(){this.size({width:e.PLAYER_WIDTH,height:e.PLAYER_HEIGHT})}}),t(s)})}(this,this.modules),function(t,i){i.define("Cake",["tools","consts","Sprite"],function(t,i,e,n){var s=i.extend(n),a=s,o=a.superclass;_.extend(a.prototype,{initialize:function(t){o.initialize.call(this,{sprite:"/resources/images/sprites/cake50.png",steps:36,speed:25,size:{width:e.CAKE_WIDTH,height:e.CAKE_HEIGHT}})},_updateSize:function(){this.size({width:e.CAKE_WIDTH,height:e.CAKE_HEIGHT})}}),t(s)})}(this,this.modules),function(t,i){i.define("AllEnemies",["consts","Enemy1","Enemy2","Enemy3","Enemy4","Enemy5"],function(t,i,e,n,s,a,o){t([{type:i.ENEMY_TYPE_1,constr:e},{type:i.ENEMY_TYPE_2,constr:n},{type:i.ENEMY_TYPE_3,constr:s},{type:i.ENEMY_TYPE_4,constr:a},{type:i.ENEMY_TYPE_5,constr:o}])})}(this,this.modules),function(t,i){i.define("Explosion",["tools","consts","Sprite"],function(t,i,e,n){var s=i.extend(n),a=s,o=a.superclass;_.mixin(a.prototype,{initialize:function(t){o.initialize.call(this,{sprite:"/resources/images/sprites/explosion16.png",steps:16,speed:25,loop:!1,size:{width:e.EXPLOSION_WIDTH,height:e.EXPLOSION_HEIGHT}})}}),t(s)})}(this,this.modules),function(t,i){i.define("EnemyBase",["tools","consts","Resource"],function(t,i,e,n){var s=i.extend(n),a=s,o=a.superclass;_.mixin(a.prototype,{initialize:function(t){o.initialize.apply(this,arguments)},getBoundingBox:function(){if(this._resource){var t=this._resource.height,i=this._canvas.height,e=this._resource.width,n=this._canvas.width,s=i/t,a=e*s;return{t:0,l:n/2-a/2,w:a,h:i}}},_draw:function(){this.redraw();var t=this._resource.height,i=this._canvas.height,e=this._resource.width,n=this._canvas.width,s=i/t,a=e*s;this._context.drawImage(this._resource,0,0,e,t,n/2-a/2,0,a,i)},_updateSize:function(){this.size({width:e.ENEMY_CELL_WIDTH,height:e.ENEMY_CELL_HEIGHT})}}),t(s)})}(this,this.modules),function(t,i){i.define("Enemy1",["tools","consts","EnemyBase"],function(t,i,e,n){var s=i.extend(n),a=s,o=a.superclass;_.mixin(a.prototype,{initialize:function(t){o.initialize.call(this,{src:"/resources/images/cocktails/1.png"})}}),t(s)})}(this,this.modules),function(t,i){i.define("Enemy2",["tools","consts","EnemyBase"],function(t,i,e,n){var s=i.extend(n),a=s,o=a.superclass;_.mixin(a.prototype,{initialize:function(t){o.initialize.call(this,{src:"/resources/images/cocktails/2.png"})}}),t(s)})}(this,this.modules),function(t,i){i.define("Enemy3",["tools","consts","EnemyBase"],function(t,i,e,n){var s=i.extend(n),a=s,o=a.superclass;_.mixin(a.prototype,{initialize:function(t){o.initialize.call(this,{src:"/resources/images/cocktails/3.png"})}}),t(s)})}(this,this.modules),function(t,i){i.define("Enemy4",["tools","consts","EnemyBase"],function(t,i,e,n){var s=i.extend(n),a=s,o=a.superclass;_.mixin(a.prototype,{initialize:function(t){o.initialize.call(this,{src:"/resources/images/cocktails/4.png"})}}),t(s)})}(this,this.modules),function(t,i){i.define("Enemy5",["tools","consts","EnemyBase"],function(t,i,e,n){var s=i.extend(n),a=s,o=a.superclass;_.mixin(a.prototype,{initialize:function(t){o.initialize.call(this,{src:"/resources/images/cocktails/5.png"})}}),t(s)})}(this,this.modules);